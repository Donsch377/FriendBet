-- Enable UUID extension
create extension if not exists "uuid-ossp";

create table groups (
  id uuid primary key default uuid_generate_v4(),
  name text not null,
  join_code text unique not null default upper(left(replace(uuid_generate_v4()::text, '-', ''), 6)),
  start_points integer not null default 100,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

create table members (
  id uuid primary key default uuid_generate_v4(),
  group_id uuid references groups(id) on delete cascade,
  name text not null,
  points integer not null,
  is_admin boolean not null default false,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

create table bets (
  id uuid primary key default uuid_generate_v4(),
  group_id uuid references groups(id) on delete cascade,
  creator_member_id uuid references members(id) on delete set null,
  description text not null,
  option_a text not null,
  option_b text not null,
  status text not null default 'open',
  winning_option text,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

create table bet_exclusions (
  bet_id uuid references bets(id) on delete cascade,
  member_id uuid references members(id) on delete cascade,
  primary key (bet_id, member_id)
);

create table wagers (
  bet_id uuid references bets(id) on delete cascade,
  member_id uuid references members(id) on delete cascade,
  option text not null,
  amount integer not null,
  primary key (bet_id, member_id)
);
